<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>{{ display_name }} ì‚¬ì§„ ì—…ë¡œë”</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    h1 {
      font-size: 28px;
      margin-bottom: 10px;
    }
    .subtitle {
      font-size: 14px;
      color: #666;
      margin-bottom: 30px;
    }
    .upload-status {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 20px;
    }
    .upload-status.complete::after {
      content: " âœ”ï¸";
      color: green;
    }
    label.customer-label {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 6px;
      display: block;
    }
    #customerName {
      padding: 10px;
      font-size: 16px;
      width: 300px;
      margin-bottom: 30px;
    }
    .upload-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .thumb-box {
      width: 200px;
      display: flex;
      flex-direction: column;
      align-items: center;
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      box-sizing: border-box;
      transition: border 0.3s;
    }
    .thumb-box.complete {
      border: 3px solid #0ace03;
    }
    .thumb-img {
      width: 180px;
      height: 100px;
      object-fit: cover;
      margin-bottom: 10px;
    }
    .upload-input {
      margin: 6px 0;
      width: 180px;
    }
    .upload-button {
      padding: 5px 12px;
      font-size: 13px;
      cursor: pointer;
    }
    .checkmark {
      font-size: 22px;
      color: rgb(0, 177, 0);
      margin-top: 4px;
    }
    .desc-text {
      font-size: 12px;
      color: #666;
      margin-top: 8px;
      text-align: center;
      word-break: keep-all;
    }
  </style>
</head>
<body>
  <h1>ğŸ–¼ï¸ {{ display_name }} ì œì‘ ì‚¬ì§„ ì—…ë¡œë”</h1>
  <div class="subtitle" style="line-height: 1.7;">
  ğŸ“Œ <strong>ì‚¬ì§„ì€ í•œ ì»·ì”© ì—…ë¡œë“œ</strong> í›„, 'ì—…ë¡œë“œí•˜ê¸°' ë²„íŠ¼ì„ ê¼­ ëˆŒëŸ¬ì£¼ì„¸ìš”.<br>
  ğŸ“Œ <strong>ì²˜ìŒ ì—…ë¡œë“œ ì‹œ</strong> ëª‡ ì´ˆê°„ ë¡œë”©ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
  ğŸ“Œ <strong>ì—…ë¡œë“œëœ í›„ì—” ì„ì‹œì €ì¥</strong>ë˜ì–´ ì¤‘ë‹¨ í›„ ë‹¤ì‹œ ì ‘ì†í•´ë„ ì´ì–´ì„œ ì‘ì—… ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>
  ğŸ“Œ <strong>'ì£¼ë¬¸ì-ì£¼ì¸ê³µ' ì´ë¦„ì€</strong> ì—…ë¡œë“œ í´ë”ëª…ì´ ë˜ë¯€ë¡œ <u>ë³€ê²½í•˜ì§€ ë§ˆì„¸ìš”</u>.<br>
  ğŸ“Œ <strong>ì¬ì—…ë¡œë“œ ì‹œ</strong> ê¸°ì¡´ íŒŒì¼ì€ ìë™ìœ¼ë¡œ <u>ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤</u>.<br>
  ğŸ“Œ <strong>ìµœì´ˆ ì—…ë¡œë“œì—ë§Œ</strong> ì‚¬ìš©í•˜ëŠ” ì°½ì…ë‹ˆë‹¤. <u>ì‹œì•ˆë°›ì•„ë³´ì‹œê³  ìˆ˜ì •ë‹¨ê³„ë¼ë©´ ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ë§ì”€í•´ì£¼ì„¸ìš”</u>.<br>
  ğŸ“Œì—…ë¡œë“œëœ ìë£ŒëŠ” ê¿ˆê¾¸ë‹¤ <strong>ë“œë¼ì´ë¸Œ</strong>ì— ì €ì¥ë˜ë©°, ì˜ì—…ì¼ ì˜¤ì „ ìˆœì°¨ í™•ì¸ í›„ ê°œë³„ ì—°ë½ë“œë¦½ë‹ˆë‹¤.<br><br>

  â— ì˜¤ë¥˜ ì‹œ <a href="mailto:info@dream-ing.kr">info@dream-ing.kr</a> ë˜ëŠ”
  <a href="http://pf.kakao.com/_qzxanV/chat" target="_blank" style="color:#3366cc;">ì¹´ì¹´ì˜¤í†¡ @ê¿ˆê¾¸ë‹¤</a> ë¡œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.<br>
  ğŸ“¦ <strong>ì—…ë¡œë”/ë©”ì¼/ì¹´í†¡ ì¤‘</strong> ì…‹ì¤‘ í¸í•˜ì‹  ê³³ìœ¼ë¡œ ë³´ë‚´ì£¼ì„¸ìš”. ì–´ëŠê³³ì´ë“  í™•ì¸ë§Œë¼ë©´ ì œì‘ ê°€ëŠ¥í•©ë‹ˆë‹¤. </div>

<!-- ì•ˆë‚´ ë©”ì‹œì§€ -->
<label class="customer-label">ğŸ‘¤ 'ì£¼ë¬¸ì-ì£¼ì¸ê³µ' ì´ë¦„ì„ ì ì–´ì£¼ì„¸ìš”</label>

<input type="text" id="customerName" placeholder="ì˜ˆ: í™ê¸¸ë™-í™ê¸¸ìˆœ" style="margin-bottom: 4px;">
<div style="font-size: 14px; color: #888;">
  * ìœ„ ì´ë¦„ì´ ì—…ë¡œë“œ í´ë”ëª…ìœ¼ë¡œ ì‚¬ìš©ë˜ë¯€ë¡œ ë³€ê²½í•˜ì§€ ë§ˆì„¸ìš”.
</div>

<!-- êµ¬ë¶„ì„  -->
<hr style="border: none; border-top: 1px dashed #ccc; margin: 24px 0 12px 0;">

<!-- ì—…ë¡œë“œ ì™„ë£Œ ê°¯ìˆ˜ | ì´ˆê¸°í™” ë²„íŠ¼ -->
<div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
  <div id="uploadStatus"
       style="font-size: 17px; font-weight: bold; height: 32px; display: flex; align-items: center;">
    38 ì¤‘ 0ê°œ ì—…ë¡œë“œ ì™„ë£Œ
  </div>
  <div style="height: 16px; width: 3px; background-color: #ccc;"></div>
  <button onclick="resetUploads()"
          style="font-size: 13px; height: 32px; padding: 0 12px; display: flex; align-items: center;">
    ğŸ—‘ ì—…ë¡œë“œ ì´ˆê¸°í™”
  </button>
</div>


  <!-- ì´ ì»· ìˆ˜ -->
  <span id="totalCount" style="display:none;">{{ photo_list | length }}</span>

  <div class="upload-grid">
    {% for photo in photo_list %}
      <div class="thumb-box" id="box-{{ photo.id }}">
        <img class="thumb-img" src="/thumbs/{{ sample }}/{{ photo.id }}.jpg" alt="{{ photo.desc or 'ì¸ë„¤ì¼' }}">
        <strong>{{ photo.id }}</strong>
        <input type="file" id="file-{{ photo.id }}" class="upload-input">
        <button class="upload-button" onclick="uploadFile('{{ photo.id }}')">ì—…ë¡œë“œí•˜ê¸°</button>
        <div id="check-{{ photo.id }}" class="checkmark"></div>
        <div class="desc-text">{{ photo.desc }}</div>
        <img id="preview-{{ photo.id }}" class="thumb-img" style="margin-top:10px; display:none;" alt="ì—…ë¡œë“œ ë¯¸ë¦¬ë³´ê¸°">
      </div>
    {% endfor %}
  </div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const total = parseInt(document.getElementById('totalCount').innerText, 10);
        let uploaded = 0;
        const uploadedSet = new Set();

        function updateStatus() {
            const status = document.getElementById('uploadStatus');
            status.textContent = `${total} ì¤‘ ${uploaded}ê°œ ì—…ë¡œë“œ ì™„ë£Œ`;
        }

        function saveToLocal(photoId, dataUrl) {
            localStorage.setItem(`preview_${photoId}`, dataUrl);
        }

        function saveUploaded(photoId) {
            localStorage.setItem(`uploaded_${photoId}`, "true");
        }

        function loadFromLocal(photoId) {
            return localStorage.getItem(`preview_${photoId}`);
        }

        function isUploaded(photoId) {
            return localStorage.getItem(`uploaded_${photoId}`) === "true";
        }

        window.uploadFile = function (photoId, fileOverride = null) {
            const fileInput = document.getElementById('file-' + photoId);
            const file = fileOverride || fileInput.files[0];
            if (!file) {
                alert('ì‚¬ì§„ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”!');
                return;
            }

            const customerName = document.getElementById('customerName').value.trim();
            if (!customerName) {
                alert('ì£¼ë¬¸ì-ì£¼ì¸ê³µ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            let finalFile = file;
            if (!file.name.includes('.')) {
                finalFile = new File([file], file.name + '.jpg', { type: file.type });
            }

            const formData = new FormData();
            formData.append('file', finalFile);
            formData.append('customer_name', customerName);

            fetch(`/upload_file/{{ sample }}/${photoId}`, {
                method: 'POST',
                body: formData
            })
            .then(res => res.text())
            .then(msg => {
                alert(`${photoId} ì—…ë¡œë“œ ê²°ê³¼: ${msg}`);
                document.getElementById('check-' + photoId).innerText = 'âœ”ï¸';
                document.getElementById('box-' + photoId).classList.add('complete');
                saveUploaded(photoId);

                const reader = new FileReader();
                reader.onload = function (e) {
                    const previewImg = document.getElementById('preview-' + photoId);
                    previewImg.src = e.target.result;
                    previewImg.style.display = 'block';
                    saveToLocal(photoId, e.target.result);
                };
                reader.readAsDataURL(finalFile);

                if (!uploadedSet.has(photoId)) {
                    uploadedSet.add(photoId);
                    uploaded++;
                    updateStatus();
                }
            })
            .catch(err => {
                alert(`âŒ ì˜¤ë¥˜ ë°œìƒ: ${err}`);
            });
        };

        // âœ… ì—…ë¡œë“œ ìƒíƒœ ë³µì›
        {% for photo in photo_list %}
            const savedPreview_{{ photo.id }} = loadFromLocal("{{ photo.id }}");
            if (savedPreview_{{ photo.id }}) {
                const previewImg = document.getElementById("preview-{{ photo.id }}");
                previewImg.src = savedPreview_{{ photo.id }};
                previewImg.style.display = 'block';
            }

            if (isUploaded("{{ photo.id }}")) {
                document.getElementById('check-{{ photo.id }}').innerText = 'âœ”ï¸';
                document.getElementById('box-{{ photo.id }}').classList.add('complete');
                uploadedSet.add("{{ photo.id }}");
                uploaded++;
            }
        {% endfor %}

        updateStatus();

        // âœ… ì£¼ë¬¸ì ì´ë¦„ë„ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥/ë³µì›
        const nameInput = document.getElementById('customerName');
        const storedName = localStorage.getItem('customer_name');
        if (storedName) {
            nameInput.value = storedName;
        }

        nameInput.addEventListener('input', function () {
            localStorage.setItem('customer_name', nameInput.value.trim());
        });

        // âœ… ì´ˆê¸°í™” ë²„íŠ¼ í•¨ìˆ˜
        window.resetUploads = function () {
            if (confirm('ì •ë§ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\në¸Œë¼ìš°ì € ê¸°ë¡ì´ ì‚­ì œë˜ë©° ìƒˆë¡œê³ ì¹¨ë©ë‹ˆë‹¤.')) {
                localStorage.clear();
                location.reload();
            }
        };
    });
</script>

</body>
</html>
